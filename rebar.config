% vim:ts=4 sw=4 et ft=erlang
{cover_enabled, true}.

{erl_opts, [
    debug_info
]}.

{pre_hooks, [
    {"(linux|darwin|solaris|bsd)", compile, "./do-plugins.escript"},
    {"(linux|darwin|solaris|bsd)", compile, "etc/assemble_config.escript etc etc/autogenerated.config.all"},
    %{"(linux|darwin|solaris|bsd)", release, "./make_version_file.escript go"},
    {"win32", compile, "pre_compile.cmd"}
]}.

{post_hooks, [
    %{"(linux|darwin|solaris|bsd)", release, "./make_version_file.escript finish"}
]}.

{relx, [{release, {nitrogen, git}, [
            sasl,
            {cowboy, load},
            {sync, load},
            {nitrogen_core, load},
            canister,
            nitrogen_website
        ]},
        {sys_config, "etc/autogenerated.config.all"},
        {vm_args, "vm.args"},
        {mode, prod},
        {include_erts, false},
        %% Nitrogen requires debug_info or all behaviors will fail.
        {debug_info, keep}, 
        {extended_start_script, true},
        {overlay, [
            {copy, "priv", "priv"}
%            {copy, "site", "site"}
        ]}
       ]
}.


{shell, [
%     {apps, nitrogen},
%     {vm_args, "etc/vm.args"}
]}.

{plugins, [
    rebar3_run,
    rebar3_appup_plugin
]}.

{deps, [
    {nitrogen_core, {git, "https://github.com/nitrogen/nitrogen_core", {branch, rebar3}}},
    % This next dep is for profiling
    %{eep, {git, "https://github.com/virtan/eep", {branch, master}}},
    sync
]}.

{profiles, [
    {cowboy, [
        {deps, [cowboy]}
    ]},
    {mochiweb, [
        {deps, [mochiweb]}
    ]},
    {inets, [
        {deps, [mimetypes]}
    ]},
    {webmachine, [
        {deps, [
            {webmachine,    {git, "https://github.com/webmachine/webmachine.git", {branch, master}}}
        ]}
    ]},
    {yaws, [
        {deps, [
            {yaws, {git, "https://github.com/erlyaws/yaws", {tag, "yaws-2.1.0"}}}
        ]}
    ]}
]}.
            
        
